<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="generator" content="Tantalum 0.1"/>
<title>Manage Tables</title>
<link rel="stylesheet" type="text/css" href="/Tantalum/themes/default/style.css" media="all" /> 
<style type="text/css">
@charset "UTF-8";
@import url(/Tantalum/yaml/core/base.css);
@import url(/Tantalum/yaml/navigation/nav_shinybuttons.css);
@import url(/Tantalum/yaml/screen/content_default.css);
@import url(/Tantalum/yaml/screen/forms.css);
@import url(/Tantalum/yaml/print/print_003_draft.css);
</style>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="/Tantalum/js/json2min.js"></script>
<link rel="stylesheet" href="http://dev.jquery.com/view/trunk/plugins/autocomplete/jquery.autocomplete.css" type="text/css" />
<script type="text/javascript" src="http://dev.jquery.com/view/trunk/plugins/autocomplete/lib/jquery.bgiframe.min.js"></script>
<script type="text/javascript" src="http://dev.jquery.com/view/trunk/plugins/autocomplete/lib/jquery.dimensions.js"></script>
<script type="text/javascript" src="http://dev.jquery.com/view/trunk/plugins/autocomplete/jquery.autocomplete.js"></script>
<script type="text/javascript">
	var json;
	var tableSelector = [];

	$(document).ready(function() {
		jQuery.getJSON('/Tantalum/ws/ManageTables', function(jsonCallback) {
			json = jsonCallback;
			
			rows_Table = json.Table;
			tablePicker = [];
			for ( var i = 0; i < json.Table.DATA.length; i++) {
				tablePicker[i] = json.Table.DATA[i].FIELDS;
			}
			position_Table();
		});
	});

	var rows_Table = null;
	
	function position_Table() {
		paint_Tables();
	}

	function edit_Table(row, value) {
		var r = rows_Table;
		r.POSITION = row;
		if (value)
			r.DATA[row].ACTION = "EDIT";
		else {
			if (r.DATA[row].DIRTY == false && r.DATA[row].ACTION == "NEW_EDIT") {
				r.DATA.splice(row, 1);
			} else
				r.DATA[row].ACTION = null;
		}
		position_Table();
	}
</script>
</head>
<body>
<div id="Tables" class="region BasicTable">
<table class="basicTable">
	<tbody>
		<tr>
			<th scope="col"></th>
			<th scope="col">ID</th>
			<th scope="col">Table name</th>
			<th scope="col">DB name</th>
		</tr>
		<tr class="template edit">
			<th scope="row" class="actionButtons"><a href="#" class="cancel"
				title="Cancel">Cancel</a></th>
			<td><span class="ManageTablesTableID"></span></td>
			<td><input type="text" class="ManageTablesName"
				name="ManageTablesName" /></td>
			<td><input type="text" class="ManageTablesDatabaseName"
				name="ManageTablesDatabaseName" /></td>
		</tr>
	</tbody>
</table>

<script type="text/javascript">
	function paint_Tables() {
		var tbody = $("#Tables").find("tbody");

		$(tbody).find("tr.data").remove();
		var template = $(tbody).find('tr.template');
		var rows = rows_Table;
		if (rows != null) {
			for ( var i = 0; i < rows.DATA.length; i++) {
				addRow_Tables(tbody, template, rows.DATA[i], i);
			}
		}
		$("input.ManageTablesName").autocomplete(tablePicker, {
			mustMatch: true,
			matchContains: true,
			formatItem: function(row, i, max) {
				return row.ManageTablesName + " (" + row.ManageTablesTableID + ")";
			},
			formatMatch: function(row, i, max) {
				return row.ManageTablesName;
			}
		});
		$("input.ManageTablesName").result(function(event, data, formatted) {
			rows_Table.DATA[rows_Table.POSITION].FIELDS = data;
			paint_Tables();
		});
		
		$(template).hide();
	}
	function addRow_Tables(tbody, template, data, i) {
		if (data.ACTION == "DELETE")
			return;
		var row = data.FIELDS;
		var rowHTML = $(template).clone();
		rowHTML.show();
		rowHTML.addClass("data");
		rowHTML.removeClass("template");
		$(rowHTML).find('.ManageTablesTableID').html(row.ManageTablesTableID);
		$(rowHTML).find('input.ManageTablesName').val(row.ManageTablesName);
		$(rowHTML).find('input.ManageTablesDatabaseName').val(row.ManageTablesDatabaseName);
		$(rowHTML).find("input.ManageTablesDatabaseName").autocomplete(data);

		$(rowHTML[1]).show(); // tr.edit
		tbody.append(rowHTML);
	}
</script>

</div>

</body>
</html>
