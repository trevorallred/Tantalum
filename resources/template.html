<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>$page.label</title>
<link href="$baseURL/themes/$theme/style.css" type=text/css rel=stylesheet>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="$baseURL/js/main.js"></script>
<script type="text/javascript">

var json;

$(document).ready(function() {
	jQuery.getJSON('$baseURL/ws/$page.name#if($urlRequest.pageId)/$urlRequest.pageId#end',
		function(jsonCallback) {
			json = jsonCallback;
			#foreach ( $view in $page.parentViews )
			rows_${view.name} = json.${view.name};
			position_${view.name}();
			#end
		}
	);
});

#foreach ( $view in $page.views )
	var rows_${view.name} = null;
	function nav_${view.name}(amount) {
		if (rows_${view.name} == null)
			return false;

		var r = rows_${view.name};
		var maxPosition = r.DATA.length - 1;
		
		r.POSITION += amount;
		if (r.POSITION < 0)
			r.POSITION = 0;
		if (r.POSITION > maxPosition)
			r.POSITION = maxPosition;

		position_${view.name}(r);
		return false;
	}

	function position_${view.name}() {
		// first paint all child regions (not recursively), and then position all child views (recursively)
		#foreach ( $region in $view.regions )
			#if( $region.regionType.hasFields )
				paint_${region.name}();
			#end
		#end
		
		if (rows_${view.name} == undefined)
			return;
	
		var row = rows_${view.name}.DATA[rows_${view.name}.POSITION];
		
		#foreach ( $childView in $view.childViews )
			rows_${childView.name} = row.CHILDREN.${childView.name};
			position_${childView.name}();
		#end
	}
#end

#foreach ( $region in $page.regions )

#if( $region.regionType.formRegion )
	function paintButtons_${region.name}() {
		var rows = rows_${region.view.name};
		if ($(rows).length > 0) {
			$('#previous${region.view.name}').attr("disabled", (rows.POSITION == 0));
			$('#next${region.view.name}').attr("disabled", (rows.POSITION == rows.DATA.length - 1));
		} else {
			$('#previous${region.view.name}').attr("disabled", true);
			$('#next${region.view.name}').attr("disabled", true);
		}
	}

	function paint_${region.name}() {
		paintButtons_${region.name}();
		
		var row = rows_${region.view.name}.DATA[rows_${region.view.name}.POSITION];
		
		#foreach ( $field in $region.fields )
			#if($field.editable)
				$("#$region.name").find('.${field.name}').val(row.FIELDS.${field.name});
			#{else}
				$("#$region.name").find('.${field.name}').html(row.FIELDS.${field.name});
			#end
		#end
	}
#end
#if( $region.regionType.basicTable )
	function paint_${region.name}() {
		var tbody = $("#$region.name").find("tbody");
		
		$(tbody).find("tr.data").remove();
		var template = $(tbody).find('tr.template');
		var rows = rows_${region.view.name};
		if (rows != null) {
			for ( var i = 0; i < rows.DATA.length; i++) {
				addRow_${region.name}(tbody, template, rows.DATA[i].FIELDS);
			}
		}
		$(template).hide();
	}
	function addRow_${region.name}(tbody, template, row) {
		var rowHTML = $(template).clone();
		rowHTML.show();
		rowHTML.addClass("data");
		rowHTML.removeClass("template");
		#foreach ( $field in $region.fields )
			$(rowHTML[1]).find('.${field.name}').val(row.${field.name});
			$(rowHTML).find('.${field.name}').html(row.${field.name});
		#end
		tbody.append(rowHTML);
	}

#end

#end

</script>
</head>
<body>
[<a href='$baseURL/t/ManageTables'>Manage Tables</a>]
[<a href='$baseURL/t/WebpageList'>List Web Pages</a>]

<h1>$page.label</h1>

#foreach ( $region in $page.parentRegions )
#parse("template_region.html")
#end

</body>
</html>
